# Project to use for create '[generic-eks-instance](https://github.com/mbasri/generic-eks-cluster)' infrastructure

## How to create/destroy the infrastructure

### 1. Initialise you environment

```shell
aws configure
```

### 2. Create the infrastructure

```shell
terraform apply
```

### 3. Prepare your cluster

You will manage your cluster via [kubectl](https://kubernetes.io/fr/docs/tasks/tools/install-kubectl/#installer-kubectl-sur-linux), `kubetcl` will base on `kubeconfig` file, this file is generated by Terraform, you need to copy/paste the file on default kubernetes config folder

```shell
mkdir ~/.kube
cp kubeconfig_kbd-lab-gkc-prd-pri ~/.kube/config
```

If you need to manage your secret via [AWS secret manager](https://aws.amazon.com/secrets-manager/), you can install the following extension

```shell
helm install --generate-name external-secrets/kubernetes-external-secrets --set env.AWS_REGION=eu-west-3
```

If you need to add [EBS strorage class](https://kubernetes.io/docs/concepts/storage/storage-classes/#aws-ebs) you can apply the following yaml file

```shell
kubectl apply -f file/init/storage-class.yaml
```

### 4. Destroy the infrastructure

```shell
terraform destroy
```

## Dependencies of the infrastructure

* This project is based on the output of the [global infrastructure project](https://github.com/sensorgraph/infra) via the data block `terraform_remote_state`
* The project is built with the [v0.12.17](https://releases.hashicorp.com/terraform/) of Terraform

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|:----:|:-----:|:-----:|

## Outputs

| Name | Description |
|------|-------------|
| cluster_endpoint | Endpoint for EKS control plane. |
| kubectl_config | kubectl config as generated by the module. |
| config_map_aws_auth |  |
| cluster_ssh_private_key | SSH key to use for the cluster |

## AWS architecture diagram

![files/lucidchart/x.png](files/lucidchart/x.png)

## Author

* [**Mohamed BASRI**](https://github.com/mbasri)

## License

This project is licensed under the MIT License - see the [LICENSE](./LICENSE) file for details
